<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta http-equiv="Content-Type" content="text/html;utf-8">
	<link rel="stylesheet" type="text/css" href="/css/style.css">
	<link rel="stylesheet" type="text/css" href="/css/quill.base.css">
	<script type="text/javascript" src="/js/lib.js"></script>
	<style type="text/css">
	</style>
	<script type="text/javascript">
		const JBILLING = [
			null,
			'Pending',
			'Final Billing',
			'Non Billable',
			'Monthly Billing',
			'Retainer',
			'Progress Billing',
			'Billable'
		]
		const JSTATUS = [
			null,
			'Open',
			'On-Hold',
			'Closed'
		]
		const JTYPE = [
			'Other',
			'Audio',
			'Media',
			'Print',
			'Video',
			'Web'
		]
	</script>
</head>
<body>

<div id="loading"></div>

<ul id="navigation">
	<li><img src="/images/otter-logo.gif"></li>
	<li>
		<a href="#" class="active">my stuff</a>
		<ul>
			<li><a href="#time">time card</a></li>
			<li><a href="#add-time">add time</a></li>
		</ul>
	</li>
	<li>
		<a href="#jobs">jobs</a>
		<ul>
			<li><a href="#add-job">add job</a></li>
			<li><a href="#jobs/1">open jobs</a></li>
			<li><a href="#jobs/3">closed jobs</a></li>
			<li><a href="#jobs/2">on-hold jobs</a></li>
		</ul>
	</li>
	<li>
		<a href="#team">team</a>
		<ul>
			<li><a href="#tasks-team">team tasks</a></li>
			<li><a href="#tasks-unassigned">unassigned tasks</a></li>
		</ul>
	</li>
<!--	<li><a href="#blog">blog</a></li>-->
	<li><a href="#reports">reports</a></li>
	<li><a href="#clients">clients</a></li>
	<li><a href="#vendors">vendors</a></li>
	<li><a href="#credentials">credentials</a></li>
	<li><a id="login-out" href="#login-out"></a></li>
</ul>

<div id="otter">

	<div id="index">
		<table class="default-table all">
			<thead>
				<tr>
					<th>Project</th><th>Task Title</th><th>Post Date</th><th>Due Date</th><th>Done</th>
				</tr>
			</thead>
			<tbody id="home-tasks">

			</tbody>
		</table>
	</div>

	<div id="clients"></div>

	<div id="vendors"></div>

	<div id="jobs">
		<div id="page-nav">
			<ul>
				<li data-link="0" class="job-search">All</li>
				<li data-link="1" class="job-search">Open</li>
				<li data-link="3" class="job-search">Closed</li>
				<li data-link="2" class="job-search">On-Hold</li>
			</ul>
			<ul>
				<li><a href="#add-job">Add Job</a></li>
			</ul>
		</div>
		<div id="job-search">
			<select id="search_type">
<!--				<option>All</option>-->
				<option selected>Job &num;</option>
				<option>Title</option>
			</select><input type="text" id="search_string"><button id="job_search">Search</button>
		</div>
	</div>

	<div id="job">
		<h1><span id="client-and-number"></span> <span id="job-title"></span></h1>
		<h2><span class="h2span">Job Status</span> <span id="job-status"></span> <span class="h2span">Type</span> <span id="job-type"></span></h2>
		<div id="job-link">
			<ul>
				<li class="job-links" id="show-job-overview" data-target="job-overview">Overview</li>
				<li class="job-links" id="show-tasks-button" data-target="job-tasks">Tasks</li>
				<li class="job-links" id="show-job-art" data-target="job-art">Art</li>
				<li class="job-links" id="show-job-invoice" data-target="job-invoices">Invoices</li>
			</ul>
			<ul>
				<li id="project-edit">Edit Project</li>
				<li><a href="#add-task" id="create-task-button">Create Task</a></li>
				<li><a href="#add-time">Add Time</a></li>
				<li><a href="#add-expense">Add Expense</a></li>
				<li><a href="#add-estimate">Add Estimate</a></li>
				<li><a href="#add-invoice">Add Invoice</a></li>
				<li><a href="add-art">Add Art</a></li>
			</ul>
		</div>
		<div id="job-details">
			<div id="name-vendor-contact" class="job-details-top">
				<p id="job-creator"><em class="no-hide">Creator </em></p>
				<p id="job-vendor"><em class="no-hide">Vendor </em></p>
				<p id="job-contact"><em class="no-hide">Contact </em></p>
			</div>
			<div id="billing-created-closed" class="job-details-top">
				<p id="job-billing"><em class="no-hide">Billing Status </em></p>
				<p id="job-created"><em class="no-hide">Created </em></p>
				<p id="job-closed"><em class="no-hide">Closed </em></p>
			</div>
			<div id="description"><em>Description</em><p id="job-description"></p></div>
		</div>
		<div class="job-details-section active" id="job-overview">
			<table class="default-table">
				<thead>
					<tr>
						<th>id</th><th>Estimate Title</th><th>Date</th><th>Added By</th><th>Gross Cost</th><th>Net Cost</th>
					</tr>
				</thead>
				<tbody id="estimate-body"></tbody>
			</table>
			<table class="default-table">
				<thead>
					<tr>
						<th>id</th><th>Time Code</th><th>Total Time</th><th>Total Cost</th>
					</tr>
				</thead>
				<tbody id="times-body"></tbody>
			</table>
			<table class="default-table">
				<thead>
					<tr>
						<th>id</th><th>Expense Title</th><th>Date</th><th>Added By</th><th>Cost</th><th>Final Cost</th>
					</tr>
				</thead>
				<tbody id="expenses-body"></tbody>
			</table>
		</div>
		<div class="job-details-section" id="job-tasks">
			<table class="default-table">
				<thead>
					<tr>
						<th>id</th><th>Task Title</th><th>Assigned To</th><th>Post Date</th><th>Due Date</th><th>Done</th>
					</tr>
				</thead>
				<tbody id="tasks-body"></tbody>
			</table>
		</div>
		<div class="job-details-section" id="job-invoices">
			<table class="default-table">
				<thead>
					<tr>
						<th>id</th><th>Invoice Title</th><th>Date</th><th>Added By</th><th>Total Cost</th>
					</tr>
				</thead>
				<tbody id="invoices-body"></tbody>
			</table>
		</div>
		<div class="job-details-section" id="job-art">
			<table class="default-table">
				<thead>
					<tr>
						<th>id</th><th>Art Title</th><th>Date Added</th><th>Added By</th>
					</tr>
				</thead>
				<tbody id="art-body"></tbody>
			</table>
		</div>
	</div>

	<div id="credentials">
		<table class="default-table">
			<thead>
				<tr>
					<th>id</th><th>Site</th><th>Username</th><th>Password</th><th>Notes</th>
				</tr>
			</thead>
			<tbody id="credentials-body"></tbody>
		</table>
	</div>

	<div id="add-job">
		<input type="hidden" value="add-job" class="add-job-form" data-type="form">
		<input type="hidden" id="job-id" class="add-job-form" data-type="id">
		<select id="add-job-client-list" data-type="client" class="add-job-form">
			<option value="0">[Select Client]</option>
		</select>
		<input type="text" id="add-job-title" class="add-job-form" data-type="title">
		<select class="add-job-form" id="add-job-type-list" data-type="type">
			<option value="0">[Job Type]</option>
		</select>
		<div id="content-container">
			<div id="editor-wrapper">
			<div id="formatting-container">
				<select title="Font" class="ql-font">
					<option value="sans-serif" selected>Sans Serif</option>
					<option value="Georgia, serif">Serif</option>
					<option value="Monaco, 'Courier New', monospace">Monospace</option>
				</select>
				<select title="Size" class="ql-size">
					<option value="10px">Small</option>
					<option value="13px" selected>Normal</option>
					<option value="18px">Large</option>
					<option value="32px">Huge</option>
				</select>
				<select title="Text Color" class="ql-color">
					<option value="rgb(255, 255, 255)">White</option>
					<option value="rgb(0, 0, 0)" selected>Black</option>
					<option value="rgb(255, 0, 0)">Red</option>
					<option value="rgb(0, 0, 255)">Blue</option>
					<option value="rgb(0, 255, 0)">Lime</option>
					<option value="rgb(0, 128, 128)">Teal</option>
					<option value="rgb(255, 0, 255)">Magenta</option>
					<option value="rgb(255, 255, 0)">Yellow</option>
				</select>
				<select title="Background Color" class="ql-background">
					<option value="rgb(255, 255, 255)" selected>White</option>
					<option value="rgb(0, 0, 0)">Black</option>
					<option value="rgb(255, 0, 0)">Red</option>
					<option value="rgb(0, 0, 255)">Blue</option>
					<option value="rgb(0, 255, 0)">Lime</option>
					<option value="rgb(0, 128, 128)">Teal</option>
					<option value="rgb(255, 0, 255)">Magenta</option>
					<option value="rgb(255, 255, 0)">Yellow</option>
				</select>
				<select title="Text Alignment" class="ql-align">
					<option value="left" selected>Left</option>
					<option value="center">Center</option>
					<option value="right">Right</option>
					<option value="justify">Justify</option>
				</select>
				<button title="Bold" class="ql-format-button ql-bold">Bold</button>
				<button title="Italic" class="ql-format-button ql-italic">Italic</button>
				<button title="Underline" class="ql-format-button ql-underline">Under</button>
				<button title="Strikethrough" class="ql-format-button ql-strike">Strike</button>
				<button title="Link" class="ql-format-button ql-link">Link</button>
				<button title="Image" class="ql-format-button ql-image">Image</button>
				<button title="Bullet" class="ql-format-button ql-bullet">Bullet</button>
				<button title="List" class="ql-format-button ql-list">List</button>
			</div>
			<div id="add-job-editor" data-type="description" class="add-job-form quill-editor"></div>
			</div>
		</div>
		<select id="add-job-billing-list" class="add-job-form" data-type="billing">
			<option value="0">[Billing]</option>
		</select>
		<select id="add-job-staus-list" class="add-job-form" data-type="status">
			<option value="1" selected>Open</option>
			<option value="2">On-Hold</option>
			<option value="3">Closed</option>
		</select>
		<button>Cancel</button>
		<button id="create-job" class="submit-button" data-form="add-job-form" data-after="job/">Save</button>
	</div>

	<div id="add-client"></div>

	<div id="add-vendor"></div>

    <div id="add-client-contact"></div>

	<div id="add-task">
		<input type="hidden" value="add-task" class="add-task-form" data-type="form">
		<input id="add-task-id" type="hidden" class="add-task-form" data-type="id">
		<input type="text" id="add-task-job" class="add-task-form" data-type="job" placeholder="Job">
		<input id="add-task-title" type="text" class="add-task-form" data-type="title" placeholder="Title">
		<input id="add-task-date" type="text" class="add-task-form" data-type="date" placeholder="Date"><span class="calendar-button" data-target="add-task-date"> &#x1f4c5;</span>
		<select id="add-task-time" class="add-task-form" data-type="due">
			<option value="00:00:00">12:00am</option>
			<option value="00:30:00">12:30am</option>
			<option value="01:00:00">1:00am</option>
			<option value="01:30:00">1:30am</option>
			<option value="02:00:00">2:00am</option>
			<option value="02:30:00">2:30am</option>
			<option value="03:00:00">3:00am</option>
			<option value="03:30:00">3:30am</option>
			<option value="04:00:00">4:00am</option>
			<option value="04:30:00">4:30am</option>
			<option value="05:00:00">5:00am</option>
			<option value="05:30:00">5:30am</option>
			<option value="06:00:00">6:00am</option>
			<option value="06:30:00">6:30am</option>
			<option value="07:00:00">7:00am</option>
			<option value="07:30:00">7:30am</option>
			<option value="08:00:00">8:00am</option>
			<option value="08:30:00">8:30am</option>
			<option value="09:00:00">9:00am</option>
			<option value="09:30:00">9:30am</option>
			<option value="10:00:00">10:00am</option>
			<option value="10:30:00">10:30am</option>
			<option value="11:00:00">11:00am</option>
			<option value="11:30:00">11:30am</option>
			<option value="12:00:00">12:00pm</option>
			<option value="12:30:00">12:30pm</option>
			<option value="13:00:00">1:00pm</option>
			<option value="13:30:00">1:30pm</option>
			<option value="14:00:00">2:00pm</option>
			<option value="14:30:00">2:30pm</option>
			<option value="15:00:00">3:00pm</option>
			<option value="15:30:00">3:30pm</option>
			<option value="16:00:00">4:00pm</option>
			<option value="16:30:00">4:30pm</option>
			<option value="17:00:00" selected>5:00pm</option>
			<option value="17:30:00">5:30pm</option>
			<option value="18:00:00">6:00pm</option>
			<option value="18:30:00">6:30pm</option>
			<option value="19:00:00">7:00pm</option>
			<option value="19:30:00">7:30pm</option>
			<option value="20:00:00">8:00pm</option>
			<option value="20:30:00">8:30pm</option>
			<option value="21:00:00">9:00pm</option>
			<option value="21:30:00">9:30pm</option>
			<option value="22:00:00">10:00pm</option>
			<option value="22:30:00">10:30pm</option>
			<option value="23:00:00">11:00pm</option>
			<option value="23:30:00">11:30pm</option>
		</select>
		<div id="task-content-container">
			<div id="task-editor-wrapper">
			<div id="task-formatting-container">
				<select title="Font" class="ql-font">
					<option value="sans-serif" selected>Sans Serif</option>
					<option value="Georgia, serif">Serif</option>
					<option value="Monaco, 'Courier New', monospace">Monospace</option>
				</select>
				<select title="Size" class="ql-size">
					<option value="10px">Small</option>
					<option value="13px" selected>Normal</option>
					<option value="18px">Large</option>
					<option value="32px">Huge</option>
				</select>
				<select title="Text Color" class="ql-color">
					<option value="rgb(255, 255, 255)">White</option>
					<option value="rgb(0, 0, 0)" selected>Black</option>
					<option value="rgb(255, 0, 0)">Red</option>
					<option value="rgb(0, 0, 255)">Blue</option>
					<option value="rgb(0, 255, 0)">Lime</option>
					<option value="rgb(0, 128, 128)">Teal</option>
					<option value="rgb(255, 0, 255)">Magenta</option>
					<option value="rgb(255, 255, 0)">Yellow</option>
				</select>
				<select title="Background Color" class="ql-background">
					<option value="rgb(255, 255, 255)" selected>White</option>
					<option value="rgb(0, 0, 0)">Black</option>
					<option value="rgb(255, 0, 0)">Red</option>
					<option value="rgb(0, 0, 255)">Blue</option>
					<option value="rgb(0, 255, 0)">Lime</option>
					<option value="rgb(0, 128, 128)">Teal</option>
					<option value="rgb(255, 0, 255)">Magenta</option>
					<option value="rgb(255, 255, 0)">Yellow</option>
				</select>
				<select title="Text Alignment" class="ql-align">
					<option value="left" selected>Left</option>
					<option value="center">Center</option>
					<option value="right">Right</option>
					<option value="justify">Justify</option>
				</select>
				<button title="Bold" class="ql-format-button ql-bold">Bold</button>
				<button title="Italic" class="ql-format-button ql-italic">Italic</button>
				<button title="Underline" class="ql-format-button ql-underline">Under</button>
				<button title="Strikethrough" class="ql-format-button ql-strike">Strike</button>
				<button title="Link" class="ql-format-button ql-link">Link</button>
				<button title="Image" class="ql-format-button ql-image">Image</button>
				<button title="Bullet" class="ql-format-button ql-bullet">Bullet</button>
				<button title="List" class="ql-format-button ql-list">List</button>
			</div>
			<div id="add-task-editor" data-type="description" class="add-task-form quill-editor"></div>
			</div>
		</div>
		<select class="add-task-form" id="add-task-user-list" data-type="users" multiple>
			<option value="0" class="no-hide" selected>Unassigned</option>
		</select>
		<button class="submit-button" data-form="add-task-form" data-after="job/">Save</button>
	</div>

	<div id="show-task">
		<ul id="task-links">
			<li id="task-done">Done</li>
			<li id="task-add-time">Add Time</li>
			<li id="task-edit">Edit Task</li>
			<li id="task-view-job">Go To Job</li>
		</ul>
		<div id="task-details">
			<h2>Title: <span id="task-title"></span></h2>
			<p>Creator: <span id="task-creator"></span></p>
			<p>Due Date: <span id="task-due"></span></p>
			<p>Assigned to: <span id="task-assigned-to"></span></p>
			<p>Summary:</p>
			<div id="task-summary"></div>
		</div>
	</div>

	<div id="show-tasks"></div>

	<div id="reports">
		
		<ul>
			<li class="report-button" data-id="adminTimeSheet">Admin Timesheets</li>
			<li class="report-button" data-id="timesForProject">Times for Project</li>
			<li class="report-button" data-id="jobsSinceLastReport">Jobs Since Last Report</li>
			<li class="report-button" data-id="employeeTimesheet">Employee Times</li>
			<li class="report-button" data-id="openJobs-Tasks">Open Jobs &amp; Tasks</li>
			<li class="report-button" data-id="time-CostForClient">Time &amp; Cost for Client</li>
		</ul>

		<div class="report-area" id="adminTimeSheet">
			<h2>Admin Timesheets</h2>
			<input type="text" id="ats_start"><span class="calendar-button" data-target="ats_start"> &#x1f4c5;</span>
			<input type="text" id="ats_end"><span class="calendar-button" data-target="ats_end"> &#x1f4c5;</span>
			<button>Run Report</button>
		</div>

		<div class="report-area" id="timesForProject">
			<h2>Times for Project</h2>
			<select id="project_list"></select>
		</div>

		<div class="report-area" id="jobsSinceLastReport"><h2>Jobs Since Last Report</h2></div>

		<div class="report-area" id="employeeTimesheet"><h2>Employee Times</h2></div>

		<div class="report-area" id="openJobs-Tasks"><h2>Open Jobs &amp; Tasks</h2></div>

		<div class="report-area" id="time-CostForClient"><h2>Time &amp; Cost for Client</h2></div>


	</div>

	<div id="time"></div>

	<div id="add-time">
		<input type="hidden" value="add-time" class="add-time-form" data-type="form">
		<input type="text" class="add-time-form" data-type="job" id="add-time-job-number" placeholder="Job">
		<select class="add-time-form" data-type="hours">
			<option vlaue="">Hours</option>
			<option value="0">0</option>
			<option value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
			<option value="8">8</option>
		</select>
		<select class="add-time-form" data-type="minutes">
			<option vlaue="">Minutes</option>
			<option value="0">0</option>
			<option value=".25">15</option>
			<option value=".5">30</option>
			<option value=".75">45</option>
		</select>
		<input type="text" class="add-time-form" data-type="summary" placeholder="Summary">
		<input type="text" id="add-time-form-time-code" class="add-time-form" data-type="code" placeholder="Time Code">
		<div id="time-code-list">
			<dl>
				<dt>Account Services</dt>
				<dd class="time-code-button" data-code="101">101 - Admin (Non Billable)</dd>
				<dd class="time-code-button" data-code="103">103 - Strategic Planning</dd>
				<dd class="time-code-button" data-code="104">104 - Research</dd>
				<dd class="time-code-button" data-code="107">107 - Account Coordination</dd>
			</dl>
			<dl>
				<dt>Creative Services</dt>
				<dd class="time-code-button" data-code="201">201 - Concept Development</dd>
				<dd class="time-code-button" data-code="202">202 - Design/Layout/Art Direction</dd>
				<dd class="time-code-button" data-code="203">203 - Copywriting</dd>
			</dl>
			<dl>
				<dt>Production Services</dt>
				<dd class="time-code-button" data-code="204">204 - Electronic Production</dd>
				<dd class="time-code-button" data-code="205">205 - Electronic Imaging</dd>
				<dd class="time-code-button" data-code="206">206 - File Transfer/Maintenance</dd>
				<dd class="time-code-button" data-code="208">208 - Proofs (Color/B&amp;W)</dd>
				<dd class="time-code-button" data-code="209">209 - Printing Supervision</dd>
				<dd class="time-code-button" data-code="211">211 - Illustration</dd>
				<dd class="time-code-button" data-code="212">212 - Production Supervision</dd>
			</dl>
			<dl>
				<dt>Multimedia</dt>
				<dd class="time-code-button" data-code="301">301 - Audio Production</dd>
				<dd class="time-code-button" data-code="302">302 - Video Production</dd>
				<dd class="time-code-button" data-code="303">303 - Media Trafficking TV</dd>
				<dd class="time-code-button" data-code="304">304 - Web Design</dd>
				<dd class="time-code-button" data-code="305">305 - Web Development</dd>
			</dl>
			<dl>
				<dt>Misc</dt>
				<dd class="time-code-button" data-code="401">401 - Electronic Scanning</dd>
				<dd class="time-code-button" data-code="402">402 - Production Meetings</dd>
				<dd class="time-code-button" data-code="403">403 - Proofreading</dd>
			</dl>
		</div>
		<button class="submit-button" data-form="add-time-form" data-after="">Save</button>
	</div>

	<div id="team">
		<table class="default-table">
			<thead>
				<tr>
					<th>Name</th><th>Email</th><th>Office Phone</th><th>Cell Phone</th>
				</tr>
			</thead>
			<tbody id="team-list">

			</tbody>
		</table>
	</div>

	<div id="tasks-team">
		<table class="default-table all">
			<thead>
				<tr>
					<th>Project</th><th>Task</th><th>Date Created</th><th>Due Date</th>
				</tr>
			</thead>
			<tbody id="team-task-list">

			</tbody>
		</table>
	</div>

	<div id="tasks-unassigned">
		<table class="default-table all">
			<thead>
				<tr>
					<th>Project</th><th>Task</th><th>Date Created</th><th>Due Date</th><th>Add Task</th>
				</tr>
			</thead>
			<tbody id="unassigned-task-list">

			</tbody>
		</table>
	</div>
	
	<div id="add-expense"></div>
	<div id="add-estimate"></div>
	<div id="add-invoice"></div>
	<div id="add-art"></div>


	<div id="login">
		<input type="hidden" value="login" class="login-form" data-type="form">
		<input name="username" type="text" class="login-form" data-type="username" placeholder="Username">
		<input name="password" type="password" class="login-form" data-type="password" placeholder="Password">
		<button class="submit-button" data-form="login-form" data-after="">Login</button>
	</div>

</div>
<div id="cal-root">
	<h2 id="cal-month"></h2>
	<h2 id="cal-year"></h2>
	<table>
		<thead>
			<tr>
				<th>Sun</th><th>Mon</th><th>Tues</th><th>Weds</th><th>Thurs</th><th>Fri</th><th>Sat</th>
			</tr>
		</thead>
		<tbody id="cal-body">
		</tbody>
	</table>
	<span id="cal-prev-month">&lt;</span><span id="cal-next-month">&gt;</span>
</div>
<script type="text/javascript" src="/js/cal.js"></script>
<script type="text/javascript" src="/js/quill.min.js"></script>
<script type="text/javascript">
	window.auth = false;
	function checkAuth(){
		xhr('/api/auth.php?call=check-auth', function(res){

			if (res == true)
				window.auth = true;
			else{
				window.auth = false;
				window.location.hash = "login-out";
			}
		});
	}
	addEventToAllOfClass(document.getElementsByClassName('job-links'), 'click', function(e){
		var targets = document.getElementsByClassName('job-details-section');
		for (var i=0; i<targets.length; i++){
			targets[i].classList.remove('active');
		}
		document.getElementById(e.target.dataset.target).classList.add('active');
	})
	addEventToAllOfClass(document.getElementsByClassName('time-code-button'), 'click', function(e){
		document.getElementById('add-time-form-time-code').value = e.target.dataset.code;
	});
	var submitButtons = document.getElementsByClassName('submit-button');
	for(var i=0;i<submitButtons.length;i++){
		submitButtons[i].addEventListener('click', submitForm);
	}
	checkAuth();
	var editors = [];
	editors['add-job-editor'] = new Quill('#add-job-editor', {
		modules: {
			'toolbar': { container: '#formatting-container' },
			'link-tooltip': true,
			'image-tooltip': true
		}
	});
	editors['add-task-editor'] = new Quill('#add-task-editor', {
		modules: {
			'toolbar': { container: '#task-formatting-container' },
			'link-tooltip': true,
			'image-tooltip': true
		}
	});
	xhr('/api/php-api.php?call=list-users', function(res){
			var select = document.getElementById('add-task-user-list'), option;
			emptyElement([select]);
			for (var i=0; i<res.length; i++){
				option = document.createElement('option');
				option.value = res[i].id;
				option.appendChild(document.createTextNode(res[i].first+' '+res[i].last));
				select.appendChild(option);
			}

		});

	addEventToAllOfClass(document.getElementsByClassName('calendar-button'), 'click', calPopup);
	window.hash = window.location.hash.substring(1).split('/')[0];
	addEventToAllOfClass(document.getElementsByClassName('job-search'), 'click', function(e){
		window.location.hash = window.hash + "/" + e.target.dataset.link;
		showJobs();
	});
	addEventToAllOfClass(document.getElementsByClassName('report-button'), 'click', selectReport);
	document.getElementById('job_search').addEventListener('click', search);
	document.getElementById('search_string').addEventListener('keypress', search);
	document.getElementById('task-add-time').addEventListener('click', function(e){
		document.getElementById('add-time-job-number').value = e.target.dataset.jobNumber;
		window.location.hash = "add-time";
	});
	document.getElementById('task-done').addEventListener('click', function(e){
		var taskNumber = e.target.dataset.taskNumber;
		xhr('/api/php-api.php?call=task-done&task_id='+taskNumber, function(res){
			window.location.hash = "#task/"+taskNumber;
		});
	});
	document.getElementById('project-edit').addEventListener('click', function(e){
		var project_info = JSON.parse(e.target.dataset.information);
		document.getElementById('job-id').value = project_info.id
		document.getElementById('add-job-client-list').value = project_info.client_id;
		document.getElementById('add-job-title').value = project_info.title;
		document.getElementById('add-job-type-list').value = project_info.type;
		editors['add-job-editor'].setHTML( project_info.description);
		document.getElementById('add-job-billing-list').value = project_info.billing_status;
		document.getElementById('add-job-staus-list').value = project_info.job_status;
		window.location.hash = 'add-job';
	});
	document.getElementById('task-edit').addEventListener('click', function(e){
		var task_info = JSON.parse(e.target.dataset.task_info), user_list = document.getElementById('add-task-user-list');
		console.log(task_info['task'][0].abbr+task_info['task'][0].number);
		document.getElementById('add-task-id').value = task_info['task'][0].id;
		document.getElementById('add-task-job').value = task_info['task'][0].abbr+task_info['task'][0].number;
		document.getElementById('add-task-title').value = task_info['task'][0].title;
		document.getElementById('add-task-date').value = task_info['task'][0].due.split(" ")[0];
		document.getElementById('add-task-time').value = task_info['task'][0].due.split(" ")[1];
		for(var i=0; i<task_info['users'].length; i++){
			console.log(user_list.length);
			for(var j=0; j<user_list.length; j++){
				if (task_info['users'][i].id == user_list[j].value){
					user_list[j].selected = true;
					user_list[0].selected = false;
				}
			}

		}
		editors['add-task-editor'].setHTML(task_info['task'][0].summary);
		window.location.hash = 'add-task';
	});
	document.getElementById('task-view-job').addEventListener('click', function(e){
		window.location.hash = "job/"+e.target.dataset.job;
	});

	function search(e){
		if((e.type == 'keypress' && e.keyCode == '13') || e.type=="click")
			showJobs(1, document.getElementById('search_string').value, document.getElementById('search_type').value);
	}

	var routes = [];
	routes[''] = index;
	routes['clients'] = getClients;
	routes['vendors'] = getVendors;
	routes['jobs'] = showJobs;
	routes['job'] = showJob;
	routes['credentials'] = showCredentials;
	routes['reports'] = showReports;
	routes['add-job'] = function(){
		showRoute('add-job');
		listClients(document.getElementById('add-job-client-list'));
		selectFromConst(JTYPE, document.getElementById('add-job-type-list'));
		selectFromConst(JBILLING, document.getElementById('add-job-billing-list'));
	}
	routes['add-client'] = function(){showRoute('add-client')};
	routes['add-vendor'] = function(){showRoute('add-vendor')};
	routes['add-client-contact'] = function(){showRoute('add-client-contact')};
	routes['add-task'] = function(){
		if(typeof document.getElementById('create-task-button').dataset.jobNumber != 'undefined')
			document.getElementById('add-task-job').value = document.getElementById('create-task-button').dataset.jobNumber
		showRoute('add-task')};
	routes['task'] = function(){
		xhr('/api/php-api.php?call=show-task&task_id='+window.location.hash.substring(1).split('/')[1], function(res){
			emptyElement([
				document.getElementById('task-title'),
				document.getElementById('task-creator'),
				document.getElementById('task-due'),
				document.getElementById('task-assigned-to'),
				document.getElementById('task-summary')
			]);
			document.getElementById('task-title').appendChild(document.createTextNode(res['task'][0].title));
			document.getElementById('task-creator').appendChild(document.createTextNode(res['task'][0].first+" "+res['task'][0].last));
			document.getElementById('task-due').appendChild(document.createTextNode(res['task'][0].due));
			document.getElementById('task-summary').innerHTML = res['task'][0].summary;
			document.getElementById('task-done').dataset.taskNumber =  res['task'][0].id;
			document.getElementById('task-done').dataset.jobNumber =  res['task'][0].abbr+res['task'][0].number
			document.getElementById('task-add-time').dataset.jobNumber =  res['task'][0].abbr+res['task'][0].number
			var assigned = "";
			for (var i=0; i<res['users'].length; i++){
				if (i!=0)
					assigned += ", ";
				assigned += res['users'][i].first+" "+res['users'][i].last;
			}
			document.getElementById('task-assigned-to').appendChild(document.createTextNode(assigned));
			document.getElementById('task-edit').dataset.task_info = JSON.stringify(res);
			document.getElementById('task-view-job').dataset.job = res['task'][0].abbr+res['task'][0].number;
		});
		showRoute('show-task')
	};
	routes['login-out'] = function(){
		if (!window.auth){
			showRoute('login');
		}else{
			xhr('/api/auth.php?call=logout', function(res){
				if (res==true){
					window.auth = false;
					showRoute('login');
				}
			})
		}
	};
	routes['time'] = function(){showRoute('time');};
	routes['add-time'] = function(){showRoute('add-time');};
	routes['team'] = function(){
		xhr('/api/php-api.php?call=list-team', function(res){
			var tr, tbody = document.getElementById('team-list'), td, span;
			emptyElement(tbody);
			for(var i=0; i<res.length; i++){
				tr = document.createElement('tr');
				td = document.createElement('td');
				span = document.createElement('span');
				td.appendChild(document.createTextNode(res[i].first+" "+res[i].last));
				span.appendChild(document.createTextNode(res[i].title));
				td.appendChild(span);
				tr.appendChild(td);
				td = document.createElement('td');
				td.appendChild(document.createTextNode(res[i].username+"@ottcom.com"));
				tr.appendChild(td);
				td = document.createElement('td');
				td.appendChild(document.createTextNode(res[i].office));
				tr.appendChild(td);
				td = document.createElement('td');
				td.appendChild(document.createTextNode(res[i].cell));
				tr.appendChild(td);
				tbody.appendChild(tr);
			}
		});
		showRoute('team');
	};
	routes['tasks-team'] = function(){
		xhr('/api/php-api.php?call=team-tasks', function(res){
			var list = [], team_task_list = document.getElementById('team-task-list'),
				tr, td, a, task_list;
			emptyElement(team_task_list);
			for (var i=0; i<res.length; i++){
				if (typeof list[res[i].first+' '+res[i].last] == 'undefined')
					list[res[i].first+' '+res[i].last] = [];
				list[res[i].first+' '+res[i].last].push(res[i]);
			}
			for (var user in list){
				tr=document.createElement('tr');
				td = document.createElement('td');
				td.appendChild(document.createTextNode(user));
				td.colSpan = "4";
				td.classList.add("full-row");
				tr.appendChild(td);
				team_task_list.appendChild(tr);
				task_list = list[user];
				for(var i =0; i<task_list.length; i++){
					tr=document.createElement('tr');
					td = document.createElement('td');
					td.appendChild(document.createTextNode(task_list[i].abbr+task_list[i].number+" - "+task_list[i].job_title));
					tr.appendChild(td);
					td = document.createElement('td');
					a = document.createElement('a');
					a.appendChild(document.createTextNode(task_list[i].title));
					a.href="#task/"+task_list[i].task_id;
					td.appendChild(a);
					tr.appendChild(td);
					td = document.createElement('td');
					td.appendChild(document.createTextNode(task_list[i].created));
					tr.appendChild(td);
					td = document.createElement('td');
					td.appendChild(document.createTextNode(task_list[i].due));
					tr.appendChild(td);
					team_task_list.appendChild(tr);
				}
			}
		});
		showRoute('tasks-team');
	};
	routes['tasks-unassigned'] = function(){
		xhr('/api/php-api.php?call=unassigned-tasks', function(res){
			var unassigned_task_list = document.getElementById('unassigned-task-list'),
				tr, td, a, input, task_list = res;
			emptyElement(unassigned_task_list);
			for(var i =0; i<task_list.length; i++){
				tr=document.createElement('tr');
				td = document.createElement('td');
				td.appendChild(document.createTextNode(task_list[i].abbr+task_list[i].number+" - "+task_list[i].job_title));
				tr.appendChild(td);
				td = document.createElement('td');
				a = document.createElement('a');
				a.appendChild(document.createTextNode(task_list[i].title));
				a.href="#task/"+task_list[i].id;
				td.appendChild(a);
				tr.appendChild(td);
				td = document.createElement('td');
				td.appendChild(document.createTextNode(task_list[i].created));
				tr.appendChild(td);
				td = document.createElement('td');
				td.appendChild(document.createTextNode(task_list[i].due));
				tr.appendChild(td);
				td = document.createElement('td');
				input = document.createElement('input');
				input.type="checkbox";
				input.dataset.taskNumber = task_list[i].id;
				input.classList.add("claim-task");
				td.appendChild(input);
				tr.appendChild(td);
				unassigned_task_list.appendChild(tr);
			}
			addEventToAllOfClass(document.getElementsByClassName('claim-task'), 'click', function(e){
				xhr('/api/php-api.php?call=claim-task&task_id='+e.target.dataset.taskNumber, function(res){
					routes['tasks-unassigned']();
				});
			});
		});

		showRoute('tasks-unassigned');
	};
	routes['add-expense']=function(){showRoute('add-expense');};
	routes['add-estimate']=function(){showRoute('add-estimate');};
	routes['add-invoice']=function(){showRoute('add-invoice');};
	routes['add-art']=function(){showRoute('add-art');};

	router(routes, window.hash);

	function resetForm(form){
		var elements = document.getElementsByClassName(form),
			node = "";
		for(var i=0; i<elements.length; i++){
			node = elements[i].nodeName;
			switch (node){
				case 'DIV':
					emptyElement(elements[i].firstChild);
					break;
				case 'SELECT':
					elements[i].value=0;
					break;
				case 'INPUT':
					if (elements[i].type=="text" || elements[i].type == "password" || (elements[i].type=="hidden" && elements[i].dataset.type != 'form')){
						elements[i].value = '';
					}
					break;
				default:
					break;
			}
		}
		//window.history.back();
	}

	function submitForm(e){
		var form = e.target.dataset.form;
		var elements = document.getElementsByClassName(form),
			node = "",
			selected,
			data=new FormData();
		for(var i=0; i<elements.length; i++){
			node = elements[i].nodeName;
			switch (node){
				case 'DIV':
					data.append(elements[i].dataset.type, editors[elements[i].id].getHTML());
					break;
				case 'SELECT':
					if(elements[i].multiple){
						selected = [];
						for (var option=0; option<elements[i].length; option++){
							if (elements[i][option].selected)
								selected.push(elements[i][option].value);
						}
						data.append(elements[i].dataset.type, selected);
					}else{
						data.append(elements[i].dataset.type, elements[i].value);
					}
					break;
				case 'INPUT':
					data.append(elements[i].dataset.type, elements[i].value);
					break;
				default:
					break;
			}
		}
		//data.append('form', form);
		if (form == 'login-form'){
			xhr('/api/auth.php?call=login', function(res){
				resetForm(form);
				window.auth = res;
				if(window.auth == true)
					window.location.hash = '';
			}, 'post', data);
		}else{
			xhr('/api/php-api.php?call=submit-form', function(res){
				resetForm(form);
				var location = e.target.dataset.after;
				if (res !== true || res !== false)
					location+=res
				window.location.hash=location;
			}, 'post', data);
		}
	}

	function listClients(target){
		xhr('/api/php-api.php?call=list-client', function(res){
			var option;
			for (var i=0; i<res.length; i++){
				option = document.createElement('option');
				option.appendChild(document.createTextNode(res[i].abbr+" - "+res[i].name));
				option.value = res[i].id;
				target.appendChild(option);
			}
		});
	}
	function selectFromConst(src, target){
		var option;
		for(var i=1; i<src.length; i++){
			option = document.createElement('option');
			option.appendChild(document.createTextNode(src[i]));
			option.value = i;
			target.appendChild(option);
		}
	}

	function showReports(){
		showRoute('reports');
		document.getElementById('loading').style.display = "none";
	}

	function selectReport(e){
		hideAllOfClass(document.getElementsByClassName('report-area'));
		document.getElementById(e.target.dataset.id).style.display = "block";
	}

	function showCredentials(){
		showRoute('credentials');
		xhr('/api/php-api.php?call=credentials', function(response){
			createJobInfoTable(response, document.getElementById('credentials-body'), ['id', 'site', 'username', 'password', 'notes']);

		});
	}

	function showJob(type){
		showRoute('job');
		var job_number = window.location.hash.substring(1).split('/')[1].match(/[0-9A-Za-z]{3}?([0-9]{5,6})/)[1];
		xhr('/api/php-api.php?call=job&number='+job_number, function(response){
			emptyElement([document.getElementById('client-and-number'),
						  document.getElementById('job-title'),
						  document.getElementById('job-status'),
						  document.getElementById('job-type'),
						  document.getElementById('job-creator'),
						  //document.getElementById('job-vendor'),
						  document.getElementById('job-contact'),
						  document.getElementById('job-billing'),
						  document.getElementById('job-created'),
						  document.getElementById('job-closed')]);
			document.getElementById('client-and-number').appendChild(document.createTextNode(response[0].name+" - "+response[0].abbr+response[0].number+" | "));
			document.getElementById('create-task-button').dataset.jobNumber = response[0].abbr+response[0].number;
			document.getElementById('show-tasks-button').dataset.jobNumber = response[0].number;
			document.getElementById('job-title').appendChild(document.createTextNode(response[0].title));
			document.getElementById('job-status').appendChild(document.createTextNode(JSTATUS[response[0].job_status]));
			document.getElementById('job-type').appendChild(document.createTextNode(JTYPE[response[0].type]));
			document.getElementById('job-creator').appendChild(document.createTextNode(response[0].creator));
			//document.getElementById('job-vendor').appendChild(document.createTextNode(response[0].vendor));
			document.getElementById('job-contact').appendChild(document.createTextNode(response[0].contact));
			document.getElementById('job-billing').appendChild(document.createTextNode(JBILLING[response[0].billing_status]));
			document.getElementById('job-created').appendChild(document.createTextNode(response[0].opened));
			document.getElementById('job-closed').appendChild(document.createTextNode(response[0].closed));
			document.getElementById('job-description').innerHTML = response[0].description;
			document.getElementById('project-edit').dataset.information = JSON.stringify(response[0]);
		});
		xhr('/api/php-api.php?call=job-additional&number='+job_number, function(response){
		console.log(response.tasks);
			emptyElement([document.getElementById('client-and-number'),
						  document.getElementById('times-body'),
						  document.getElementById('estimate-body'),
						  document.getElementById('expenses-body'),
						  document.getElementById('invoices-body'),
						  document.getElementById('art-body'),
						  document.getElementById('tasks-body'),]);
			//
			createJobInfoTable(response.times, document.getElementById('times-body'), ['id', 'code', 'totaltime', response.timecodes]);
			createJobInfoTable(response.estimates, document.getElementById('estimate-body'), ['id', 'title', 'date', 'added_by', 'amount', 'net']);
			createJobInfoTable(response.expenses, document.getElementById('expenses-body'), ['id', 'title', 'date', 'added_by', 'cost', 'final_cost']);
			createJobInfoTable(response.invoices, document.getElementById('invoices-body'), ['id', 'title', 'date', 'added_by', 'amount']);
			createJobInfoTable(response.art, document.getElementById('art-body'), ['id', 'title', 'date', 'added_by']);
			createJobInfoTable(response.tasks, document.getElementById('tasks-body'), ['id', 'task-title', 'names', 'created', 'due', 'status']);

		});
		var targets = document.getElementsByClassName('job-details-section');
		for (var i=0; i<targets.length; i++){
			targets[i].classList.remove('active');
		}
		document.getElementById('job-overview').classList.add('active');
	}

	function createJobInfoTable(source, dest, cols){
		var tr, td, a, totals=0, cb;
		for(var i=0; i<source.length; i++){
			tr=document.createElement('tr');
			for(col in cols){
				td = document.createElement('td');
				if(typeof cols[col] != "object"){
					if(source[i][cols[col]] == null)
						continue;
					if (cols[col] == 'title' && source[i]['file']){
						a = document.createElement('a');
						a.href = "/upload/"+source[i]['file'];

						if(source[i].title != "")
							a.appendChild(document.createTextNode(source[i][cols[col]]));
						else
							a.appendChild(document.createTextNode(source[i]['file']));
						td.appendChild(a);
					}else if(cols[col] == 'task-title'){
						a = document.createElement('a');
						a.href = "#task/"+source[i]['id'];
						a.appendChild(document.createTextNode(source[i][cols[col]]));
						td.appendChild(a);
					}else if(cols[col]=='status'){
						cb = document.createElement('input');
						cb.type = 'checkbox';
						cb.checked = (source[i][cols[col]] ==1) ? 'checked': '';
						cb.dataset.taskNumber = source[i]['id'];
						cb.addEventListener('click', function(e){
							xhr('/api/php-api.php?call=task-done&task_id='+e.target.dataset.taskNumber, function(res){
								console.log(res);
							});
						})
						td.appendChild(cb);

					}else{
						td.appendChild(document.createTextNode(source[i][cols[col]]));
					}
				}else{
					totals+=cols[col][source[i]['code']]*source[i]['totaltime'];
					td.appendChild(document.createTextNode(cols[col][source[i]['code']]*source[i]['totaltime']));
				}
				if(cols[col] == 'final_cost'){
					totals += parseFloat(source[i][cols[col]]);
				}
				tr.appendChild(td);
			}
			dest.appendChild(tr);
		}
		if(totals != 0){
			tr = document.createElement('tr');
			tr.appendChild(document.createElement('td'));
			td = document.createElement('td');
			tr.appendChild(td);

			td.colSpan = cols.length -2;
			td.appendChild(document.createTextNode("total:"));
			td = document.createElement('td');
			tr.appendChild(td);
			td.appendChild(document.createTextNode(totals.toFixed(2)));
			dest.appendChild(tr);
		}
	}

	function router(routes, route){
		try{
			routes[route]();
			document.body.scrollTop = 0;
		}catch(e){
			var hash;
			try{
				if (route.match(/^[A-Za-z]{3}?([0-9]{5,6})$/)[1]){
					window.location.hash = '#job/'+route;

				}
			}catch(e){
				index();
			}
		}
	}
	setInterval(function(){
		if (window.hash != window.location.hash.substring(1).split('/')[0]){
			window.hash = window.location.hash.substring(1).split('/')[0];
			router(routes, window.hash);
		}
		var loginLink = document.getElementById('login-out');
		if(window.auth == true){
			if(loginLink.innerHTML != 'logout')
				loginLink.innerHTML = "logout";
		}else{
			if(loginLink.innerHTML != 'login')
				loginLink.innerHTML = "login";
		}

	}, 250);

	function index(){
		xhr('/api/php-api.php?call=home-task-list', function(res){
			var task_list = document.getElementById('home-tasks'),
				tr, td, a, input;
			emptyElement(task_list);
			for(var i =0; i<res.length; i++){
				console.log(res[i]);
				tr=document.createElement('tr');
				td = document.createElement('td');
				a = document.createElement('a');
				a.appendChild(document.createTextNode(res[i].abbr+res[i].number+" - "+res[i].job_title));
				a.href="#job/"+res[i].abbr+res[i].number;
				td.appendChild(a);
				tr.appendChild(td);
				td = document.createElement('td');
				a = document.createElement('a');
				a.appendChild(document.createTextNode(res[i].title));
				a.href="#task/"+res[i].id;
				td.appendChild(a);
				tr.appendChild(td);
				td = document.createElement('td');
				td.appendChild(document.createTextNode(res[i].created));
				tr.appendChild(td);
				td = document.createElement('td');
				td.appendChild(document.createTextNode(res[i].due));
				tr.appendChild(td);
				td = document.createElement('td');
				input = document.createElement('input');
				input.type="checkbox";
				input.dataset.taskNumber = res[i].id;
				input.classList.add("home-mark-done");
				td.appendChild(input);
				tr.appendChild(td);
				task_list.appendChild(tr);
			}
			addEventToAllOfClass(document.getElementsByClassName('home-mark-done'), 'click', function(e){
				xhr('/api/php-api.php?call=task-done&task_id='+e.target.dataset.taskNumber, function(res){
					window.location.hash="task/"+e.target.dataset.taskNumber;
				});
			});
		});
		showRoute('index');
		document.getElementById('loading').style.display = "none";
	}

	function showRoute(route){
		var routes = document.querySelectorAll('#otter > div');
		for(var i=0; i<routes.length; i++){
			if (routes[i].id == route){
				routes[i].style.display = "block";
				continue;
			}
			routes[i].style.display = "none";
		}
	}
	function jobClick(e){
		var node = e.target;
		while(node.nodeName != 'LI'){
			node = node.parentNode;

		}
		var job_number = node.dataset.job_number;
		window.location.hash = "#job/"+job_number;
	}
	function showJobs(page, search_string, search_type){
		if (!page)
			page = 1;
		if (!search_string)
			search_string = '';
		if (!search_type)
			search_type = 'all';
		showRoute('jobs');
		var status = window.location.hash.substring(1).split('/')[1] || "0";
		xhr('/api/php-api.php?call=job-search&page='+page+'&status='+status+'&search_string='+search_string+'&search_type='+search_type, function(response){
			if (!response)
				return;
			try{
				var oldul = document.getElementById('search-results');
				oldul.parentNode.removeChild(oldul);
				var oldpl = document.getElementById('page_links');
				oldpl.parentNode.removeChild(oldpl);
			}catch(e){
				//
			}
			var jobs = response[1];
			var ul = document.createElement('ul'), page_links = document.createElement('p');
			page_links.id = "page_links";
			ul.id = "search-results";
			var li, bstatus, number_title, jstatus_creator;
			for(var i=0; i<jobs.length; i++){
				li = document.createElement('li');
				bstatus = document.createElement('span');
				number_title = document.createElement('h2');
				jstatus_creator = document.createElement('h3');
				li.appendChild(bstatus);
				li.appendChild(number_title);
				li.appendChild(jstatus_creator);
				ul.appendChild(li);
				li.addEventListener('click', jobClick);
				bstatus.innerHTML = JBILLING[jobs[i].billing_status];
				number_title.innerHTML = "<em>"+jobs[i].abbr+jobs[i].number+"</em> | "+jobs[i].title;
				jstatus_creator.innerHTML = "<em>Job Status</em> "+JSTATUS[jobs[i].job_status]+" <em>Creator</em> "+jobs[i].first+" "+jobs[i].last;
				li.dataset.job_number = jobs[i].abbr+jobs[i].number;
			}
			document.getElementById('jobs').appendChild(ul);
			document.getElementById('jobs').appendChild(page_links);
			var page_count = Math.ceil(response[0]/50);
			var a, start = page-5, end = parseInt(page)+5;
			if(start < 1)
				start = 1;
			if(end > page_count)
				end = page_count;
			if(start != 1){
				a = document.createElement('a');
				a.dataset.page = 1;
				a.addEventListener('click', function(e){showJobs(e.target.dataset.page, document.getElementById('search_string').value, document.getElementById('search_type').value)});
				a.appendChild(document.createTextNode("\u00ab"));
				a.title = "first page";
				page_links.appendChild(a);
				page_links.appendChild(document.createTextNode(' '));
			}
			for(var i=start; i<=end; i++){
				a=document.createElement('a');
				a.dataset.page = i;
				a.addEventListener('click', function(e){showJobs(e.target.dataset.page, document.getElementById('search_string').value, document.getElementById('search_type').value)});
				a.appendChild(document.createTextNode(i));
				page_links.appendChild(a);
				page_links.appendChild(document.createTextNode(' '));
			}
			if(end != page_count){
				a = document.createElement('a');
				a.dataset.page = page_count;
				a.addEventListener('click', function(e){showJobs(e.target.dataset.page, document.getElementById('search_string').value, document.getElementById('search_type').value)});
				a.appendChild(document.createTextNode("\u00bb"));
				a.title = "last page";
				page_links.appendChild(a);
				page_links.appendChild(document.createTextNode(' '));
			}
		});
	}

	function getClients(){
		xhr('/api/php-api.php?call=list-clients', function(response){
			showRoute('clients');
			var client, list = buildClientVendor(['name', 'abbr'], response);
			removeOldUL('clients');
			document.getElementById('clients').appendChild(list);
			/*if ((client = window.location.hash.substring(1).split('/')[1]) != undefined){
				showClient(client);
			}*/
			try{
				var old = document.getElementById(window.hash+'info');
				old.parentNode.removeChild(old);
			}catch(e){
				//
			}
		});
	}

	function removeOldUL(type){
		var oldul;
		if(oldul = document.querySelectorAll("#"+type+" > ul")){
			for(var i=0; i<oldul.length; i++){
				oldul[i].parentNode.removeChild(oldul[i]);
			}
		}
	}

	function getVendors(){
		xhr('/api/php-api.php?call=list-vendors', function(response){
			showRoute('vendors');
			var vendor, list = buildClientVendor(['name'], response);
			removeOldUL('vendors');
			document.getElementById('vendors').appendChild(list);
			/*if ((vendor = window.location.hash.substring(1).split('/')[1]) != undefined){
				showVendor(vendor);
			}*/
			try{
				var old = document.getElementById(window.hash+'info');
				old.parentNode.removeChild(old);
			}catch(e){
				//
			}
		});
	}

	function showClientVendor(e){
		var row = e.target.row;
		xhr('/api/php-api.php?call=show-contact-vendor&type='+window.hash+'&id='+e.target.dataset.id, function (response) {
			try{
				var old = document.getElementById(window.hash+'info');
				old.parentNode.removeChild(old);
			}catch(e){
				//
			}
			var main_div = document.createElement('div'),
			name = document.createElement('h2'),
			type_abbr = document.createElement('h3'),
			notes = document.createElement('p'),
			address = document.createElement('address'), assemble_addr='';
			main_div.classList.add('client-vendor-information');
			main_div.id = window.hash+"info";
			main_div.appendChild(name);
			main_div.appendChild(type_abbr);
			main_div.appendChild(address);
			main_div.appendChild(notes);
			notes.classList.add('notes');
			document.getElementById(window.hash).appendChild(main_div);
			name.appendChild(document.createTextNode(row.name));
			if (row.type)
				type_abbr.appendChild(document.createTextNode(row.type));
			else
				type_abbr.appendChild(document.createTextNode(row.abbr));
			assemble_addr+=row.address+"<br>";
			if(row.address2 != '')
				assemble_addr+=row.address2+"<br>";
			assemble_addr+=row.city+"<br>"+row.state+"<br>"+row.zip;
			if(row.phone)
				assemble_addr+="<br>"+row.phone;
			address.innerHTML = assemble_addr;
			if(row.notes)
				notes.innerHTML=row.notes;
			var div = document.createElement('div');
			div.classList.add('contact-list');
			var p, contact = "";
			for (var i=0; i<response.length; i++){
				p = document.createElement('p');
				contact += response[i].first+"<br>"+response[i].last+"<br>"+response[i].title+"<br>"+response[i].email+"<br>"+response[i].mobile+"<br>"+response[i].office+"<br>"+response[i].ext;
				p.innerHTML = contact;
				div.appendChild(p);
				contact = "";
			}
			main_div.appendChild(div);
		});
	}

	function buildClientVendor(listKeys, response){
		var ul = document.createElement('ul');
		var li, span;
		for(var i=0; i<response.length; i++){
			li = document.createElement('li');
			li.appendChild(document.createTextNode(response[i][listKeys[0]]));
			li.dataset.id = response[i].id;
			li.row = response[i];
			li.addEventListener('click', showClientVendor);
			if(listKeys[1] != undefined){
				span = document.createElement('span');
				span.appendChild(document.createTextNode(response[i][listKeys[1]]));
				li.appendChild(span);
			}
			ul.appendChild(li);
		}
		return ul;
	}


	//simple xhr abstraction.
	function xhr(url, callback, type, params) {
		document.getElementById('loading').style.display = "block";
		type = type || "get";
		var xhr = new XMLHttpRequest();
		xhr.open(type, url);
		xhr.onreadystatechange = function(){
			if(this.readyState == 4 && this.status == 200){
				callback(JSON.parse(this.responseText));
				document.getElementById('loading').style.display = "none";
			}
		}
		xhr.send(params);
	}
	//empty out an element
	function emptyElement(element){
		if(!element.length)
			element = [element];
		var child, reserve;
		for(var list=0; list<element.length; list++){
			reserve = [];
			while (element[list].lastChild){
				try{
					child = element[list].lastChild.classList.contains('no-hide');
					if (child){
						reserve.push(element[list].lastChild);
					}
					element[list].removeChild(element[list].lastChild);
					child = false;
				}catch(e){

					element[list].removeChild(element[list].lastChild);
				}
			}
			for (var e=0; e<reserve.length; e++)
				element[list].appendChild(reserve[e]);
		}
	}
	function addEventToAllOfClass(collection, event_type, callback){
		for(var i=0; i<collection.length; i++){
			collection[i].addEventListener(event_type, callback);
		}
	}
	function hideAllOfClass(collection){
		for(var i = 0; i<collection.length; i++){
			collection[i].style.display = "none";
		}
	}
</script>
</body>
</html>
